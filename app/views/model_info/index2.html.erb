
<div class="row"> &nbsp;</div>
<div class="row">
	<div class="span9">
		<form class="form-search text-right">
	  		<input type="text" class="input-large search-query">
	  		<button type="submit" class="btn">Search</button>
	  		
		</form>
	</div>
	<div class="span3 text-right">	
		 <img width="28" height="28" alt="" src="http://l.yimg.com/dh/ap/social/profile/profile_b32.png"> Sai Ponduru
	</div>

</div>
<div class="row" >
	
	<div class="span3 accordion" id="accordion1">
		<% @models.each do |m| %>
		<div class="accordion-group">
			<div class="accordion-heading">
				<a href="#collapse<%= m%>" class="accordion-toggle" data-toggle="collapse" data-parent="accordion1"><%= m %>
				</a>
			</div>
			<div id="collapse<%= m%>" class="accordion-body collapse">
				<div class="accordion-inner">
					<ul>
					<%	m.column_names.each do |c| %>  
						<% unless ['id', 'created_at', 'updated_at'].include? c %>
							<li><a href="#" onclick="update_breadcrumbs('<%= m %>', '<%= c %>');show_notes_for('<%= m %>', '<%= c %>');"><%= c %></a></li>
						<% end %>
					<% end %>
					</ul>
				</div>
			</div>
		</div>
		<% end %>
	</div>
	<div class="span9">
		
		<div class="row">
			<ul class="breadcrumb">
			  <li><%= link_to "HOME", :root %></li>
			  <li id="table_name"> </li>
			  <li id="column_name" class="active"></li>
			</ul>
		</div>
		
		<div class="row" id="middle_column">
			
		</div>
	</div>

</div>

<script type="text/javascript">
	if (<%= @table_name.blank? %>) 
		jQuery('.breadcrumb').hide();
</script>


<script type="text/javascript">

	function update_breadcrumbs(model_name, column_name) {
		jQuery('.breadcrumb').show();
		jQuery('#table_name').html('<span class="divider">></span>' + model_name);
		jQuery('#column_name').html('<span class="divider">></span>' + column_name);
	}

	function show_notes_for(model_name, column_name) {
		// 1. Place Ajax call 
		// 2. Callback will populate #middle_column

		jQuery.getJSON("/tables/" + model_name + "/columns/" + column_name + ".json", show_notes_for_CB);
	}

	function show_notes_for_CB(response) {
		if (response.length == 0) 				// if no Notes are present in DB, show message
			jQuery('#middle_column').html('<p><b> No notes present </b></p>');
		else {
			jQuery('#middle_column').html('');	// empty out the Div (i.e. initialize to empty)
			jQuery(response).each(function(i, ele) {
				html = "";
				html = html + '<div class="well">';
				html = html + 	'<p>' + ele.note_text + '</p>' 
				html = html +	'<p class="text-right"><small> - ' + ele.author + ' , &nbsp;' + ele.updated_at  + '</small></p>';
							
				if (ele.comments.length != 0) {
					jQuery(ele.comments).each( function(i, c_ele) {
						html = html + '<hr>' + 
						'<p> <small>' + c_ele.comment_text + ' &nbsp;&nbsp;- ' + c_ele.author +', &nbsp;' + c_ele.updated_at + '</small></p>';
					});
				}
				html = html + '</div>';
				jQuery('#middle_column').append(html);
			});

		}
	}
	
</script>
